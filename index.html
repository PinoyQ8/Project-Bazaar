<!DOCTYPE html>
<html>
<head>
    <title>Trust Bazaar Market</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body { background: #f4f7f6; font-family: sans-serif; margin: 0; padding-bottom: 60px; }
        
        /* Header */
        header { background: #673ab7; color: white; padding: 15px; text-align: center; position: sticky; top:0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-bar { display: flex; justify-content: space-around; background: white; padding: 10px; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #ddd; }
        .nav-btn { background: none; border: none; font-size: 24px; color: #999; cursor: pointer; }
        .nav-btn.active { color: #673ab7; }

        /* Views */
        .view { display: none; padding: 20px; animation: fade 0.3s; }
        .view.active { display: block; }

        /* Cards */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .job-card { border-left: 5px solid #673ab7; }
        
        /* Score Circle */
        .score-circle {
            width: 120px; height: 120px; border-radius: 50%; border: 8px solid #ddd;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto; font-size: 30px; font-weight: bold; color: #333;
            transition: all 1s ease;
        }

        .btn-main { background: #673ab7; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-action { background: #e1bee7; color: #4a148c; border: none; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; float: right; }
        input, textarea { width: 90%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; display: block; }
        
        @keyframes fade { from { opacity:0; } to { opacity:1; } }
    </style>
</head>
<body>

    <header>
        <h2 style="margin:0;">Trust Bazaar</h2>
        <small id="username">Connecting...</small>
    </header>

    <div id="view-market" class="view active">
        <h3>üî• Job Feed</h3>
        <p style="font-size:12px; color:#666;">Apply to jobs to increase your Trust Score!</p>
        <div id="job-feed"></div>
    </div>

    <div id="view-post" class="view">
        <h3>üìù Post a Job (+5% Score)</h3>
        <div class="card">
            <input type="text" id="job-title" placeholder="Job Title">
            <input type="number" id="job-price" placeholder="Price (Pi)">
            <button class="btn-main" onclick="postNewJob()">Publish Job</button>
        </div>
    </div>

    <div id="view-profile" class="view">
        <div class="card" style="text-align: center;">
            <h3>Your Trust Score</h3>
            
            <div id="score-ring" class="score-circle">
                <span id="trust-score">--%</span>
            </div>
            
            <p id="score-status" style="margin-top:10px; font-weight:bold; color:#673ab7;">Calculation Pending...</p>
            <hr>
            <div style="display:flex; justify-content:space-around;">
                <div>
                    <b>Jobs Posted</b>
                    <div id="stat-posted">0</div>
                </div>
                <div>
                    <b>Applied</b>
                    <div id="stat-applied">0</div>
                </div>
            </div>
            <button class="btn-main" onclick="resetStats()" style="background:#ff5252; margin-top:20px;">Reset My Reputation</button>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchView('market')">üè†</button>
        <button class="nav-btn" onclick="switchView('post')">‚ûï</button>
        <button class="nav-btn" onclick="switchView('profile')">üë§</button>
    </div>

    <script>
        // --- 1. DATABASE (Local Storage) ---
        let myJobs = JSON.parse(localStorage.getItem('trustJobs')) || [
            { title: "Website Audit", price: 100, user: "PiCoreTeam" }
        ];
        
        // This holds your reputation stats
        let userStats = JSON.parse(localStorage.getItem('trustStats')) || {
            posted: 0,
            applied: 0
        };

        // --- 2. THE SCORING LOGIC ---
        function updateScore() {
            // Base score for simply having an account
            let score = 60; 
            
            // Add points for actions
            score += (userStats.posted * 5);  // 5% per job posted
            score += (userStats.applied * 2); // 2% per job applied
            
            // Cap at 100%
            if (score > 100) score = 100;

            // Update UI
            document.getElementById('trust-score').innerText = score + "%";
            document.getElementById('stat-posted').innerText = userStats.posted;
            document.getElementById('stat-applied').innerText = userStats.applied;

            // Update Ring Color based on score
            const ring = document.getElementById('score-ring');
            if(score < 70) ring.style.borderColor = "#ff9800"; // Orange
            else if(score < 90) ring.style.borderColor = "#2196f3"; // Blue
            else ring.style.borderColor = "#4caf50"; // Green for Verified
            
            document.getElementById('score-status').innerText = score >= 90 ? "üåü VERIFIED PIONEER" : "Member";
        }

        // --- 3. ACTIONS ---
        function postNewJob() {
            const title = document.getElementById('job-title').value;
            const price = document.getElementById('job-price').value;
            const user = document.getElementById('username').innerText;

            if(!title || !price) return alert("Fill all fields");

            myJobs.unshift({ title: title, price: price, user: user });
            localStorage.setItem('trustJobs', JSON.stringify(myJobs));
            
            // INCREASE STATS
            userStats.posted += 1;
            saveStats();

            alert("‚úÖ Job Posted! Trust Score +5%");
            document.getElementById('job-title').value = "";
            document.getElementById('job-price').value = "";
            switchView('market');
        }

        function apply(title) {
            if(confirm("Apply for " + title + "? (Simulated 1 Pi Payment)")) {
                // INCREASE STATS
                userStats.applied += 1;
                saveStats();
                alert("üöÄ Applied! Trust Score +2%");
                // Here you would put the real payment code
            }
        }

        function saveStats() {
            localStorage.setItem('trustStats', JSON.stringify(userStats));
        }

        function resetStats() {
            if(confirm("Reset your reputation to zero?")) {
                userStats = { posted: 0, applied: 0 };
                saveStats();
                updateScore();
            }
        }

        // --- 4. NAVIGATION ---
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            
            if(viewName === 'market') renderFeed();
            if(viewName === 'profile') updateScore(); // Recalculate score when opening profile
        }

        function renderFeed() {
            const feed = document.getElementById('job-feed');
            feed.innerHTML = "";
            myJobs.forEach(job => {
                feed.innerHTML += `
                    <div class="card job-card">
                        <button class="btn-action" onclick="apply('${job.title}')">APPLY</button>
                        <h4>${job.title}</h4>
                        <div style="color:#673ab7;">${job.price} œÄ</div>
                        <small>Posted by: ${job.user}</small>
                    </div>
                `;
            });
        }

        // --- 5. START ---
        window.onload = function() {
            renderFeed();
            try {
                Pi.init({ version: "2.0" });
                Pi.authenticate(['username', 'payments'], (p) => { Pi.payment.complete(p.identifier); })
                    .then(auth => { document.getElementById('username').innerText = auth.user.username; });
            } catch(e) {}
        };
    </script>
</body>
</html>